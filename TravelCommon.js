/**
 * 味觉风景公共js
 * 同时其他模块也可以调用 
 */
var CONSTANTPROVINCE = {
	"1": {
		"provinceId": "1",
		"chinaAreaId": "0",
		"provinceName": "\u56fd\u5916",
		"type": "5",
		"sort": "-10",
		"state": "1"
	},
	"8": {
		"provinceId": "8",
		"chinaAreaId": "10",
		"provinceName": "\u76f4\u8f96\u5e02",
		"type": "2",
		"sort": "1000",
		"state": "1"
	},
	"10": {
		"provinceId": "10",
		"chinaAreaId": "2",
		"provinceName": "\u5317\u4eac",
		"type": "1",
		"sort": "1000",
		"state": "1"
	},
	"11": {
		"provinceId": "11",
		"chinaAreaId": "3",
		"provinceName": "\u4e0a\u6d77",
		"type": "1",
		"sort": "950",
		"state": "1"
	},
	"12": {
		"provinceId": "12",
		"chinaAreaId": "2",
		"provinceName": "\u5929\u6d25",
		"type": "1",
		"sort": "930",
		"state": "1"
	},
	"13": {
		"provinceId": "13",
		"chinaAreaId": "7",
		"provinceName": "\u91cd\u5e86",
		"type": "1",
		"sort": "920",
		"state": "1"
	},
	"14": {
		"provinceId": "14",
		"chinaAreaId": "2",
		"provinceName": "\u6cb3\u5317",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"15": {
		"provinceId": "15",
		"chinaAreaId": "2",
		"provinceName": "\u5c71\u897f",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"16": {
		"provinceId": "16",
		"chinaAreaId": "2",
		"provinceName": "\u5185\u8499\u53e4",
		"type": "3",
		"sort": "0",
		"state": "1"
	},
	"17": {
		"provinceId": "17",
		"chinaAreaId": "5",
		"provinceName": "\u8fbd\u5b81",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"18": {
		"provinceId": "18",
		"chinaAreaId": "5",
		"provinceName": "\u5409\u6797",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"19": {
		"provinceId": "19",
		"chinaAreaId": "5",
		"provinceName": "\u9ed1\u9f99\u6c5f",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"20": {
		"provinceId": "20",
		"chinaAreaId": "3",
		"provinceName": "\u6c5f\u82cf",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"21": {
		"provinceId": "21",
		"chinaAreaId": "3",
		"provinceName": "\u6d59\u6c5f",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"22": {
		"provinceId": "22",
		"chinaAreaId": "3",
		"provinceName": "\u5b89\u5fbd",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"23": {
		"provinceId": "23",
		"chinaAreaId": "3",
		"provinceName": "\u798f\u5efa",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"24": {
		"provinceId": "24",
		"chinaAreaId": "3",
		"provinceName": "\u6c5f\u897f",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"25": {
		"provinceId": "25",
		"chinaAreaId": "3",
		"provinceName": "\u5c71\u4e1c",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"26": {
		"provinceId": "26",
		"chinaAreaId": "4",
		"provinceName": "\u6cb3\u5357",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"27": {
		"provinceId": "27",
		"chinaAreaId": "4",
		"provinceName": "\u6e56\u5317",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"28": {
		"provinceId": "28",
		"chinaAreaId": "4",
		"provinceName": "\u6e56\u5357",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"29": {
		"provinceId": "29",
		"chinaAreaId": "1",
		"provinceName": "\u5e7f\u4e1c",
		"type": "2",
		"sort": "900",
		"state": "1"
	},
	"30": {
		"provinceId": "30",
		"chinaAreaId": "1",
		"provinceName": "\u5e7f\u897f",
		"type": "3",
		"sort": "0",
		"state": "1"
	},
	"31": {
		"provinceId": "31",
		"chinaAreaId": "1",
		"provinceName": "\u6d77\u5357",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"32": {
		"provinceId": "32",
		"chinaAreaId": "7",
		"provinceName": "\u56db\u5ddd",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"33": {
		"provinceId": "33",
		"chinaAreaId": "7",
		"provinceName": "\u8d35\u5dde",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"34": {
		"provinceId": "34",
		"chinaAreaId": "7",
		"provinceName": "\u4e91\u5357",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"35": {
		"provinceId": "35",
		"chinaAreaId": "7",
		"provinceName": "\u897f\u85cf",
		"type": "3",
		"sort": "0",
		"state": "1"
	},
	"36": {
		"provinceId": "36",
		"chinaAreaId": "6",
		"provinceName": "\u9655\u897f",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"37": {
		"provinceId": "37",
		"chinaAreaId": "6",
		"provinceName": "\u7518\u8083",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"38": {
		"provinceId": "38",
		"chinaAreaId": "6",
		"provinceName": "\u9752\u6d77",
		"type": "2",
		"sort": "0",
		"state": "1"
	},
	"39": {
		"provinceId": "39",
		"chinaAreaId": "6",
		"provinceName": "\u5b81\u590f",
		"type": "3",
		"sort": "0",
		"state": "1"
	},
	"40": {
		"provinceId": "40",
		"chinaAreaId": "6",
		"provinceName": "\u65b0\u7586",
		"type": "3",
		"sort": "0",
		"state": "1"
	},
	"41": {
		"provinceId": "41",
		"chinaAreaId": "8",
		"provinceName": "\u9999\u6e2f",
		"type": "4",
		"sort": "-3",
		"state": "1"
	},
	"42": {
		"provinceId": "42",
		"chinaAreaId": "8",
		"provinceName": "\u6fb3\u95e8",
		"type": "4",
		"sort": "-3",
		"state": "1"
	},
	"43": {
		"provinceId": "43",
		"chinaAreaId": "8",
		"provinceName": "\u53f0\u6e7e",
		"type": "2",
		"sort": "-2",
		"state": "1"
	}
};

var EMOTIONS = [{
	'id': 1,
	'phrase': '[呵呵]',
	'url': '1.png'
}, {
	'id': 2,
	'phrase': '[嘻嘻]',
	'url': '2.png'
}, {
	'id': 3,
	'phrase': '[哈哈]',
	'url': '3.png'
}, {
	'id': 4,
	'phrase': '[可爱]',
	'url': '4.png'
}, {
	'id': 5,
	'phrase': '[可怜]',
	'url': '5.png'
}, {
	'id': 6,
	'phrase': '[挖鼻孔]',
	'url': '6.png'
}, {
	'id': 7,
	'phrase': '[吃惊]',
	'url': '7.png'
}, {
	'id': 8,
	'phrase': '[害羞]',
	'url': '8.png'
}, {
	'id': 9,
	'phrase': '[挤眼]',
	'url': '9.png'
}, {
	'id': 10,
	'phrase': '[闭嘴]',
	'url': '10.png'
}, {
	'id': 11,
	'phrase': '[鄙视]',
	'url': '11.png'
}, {
	'id': 12,
	'phrase': '[爱你]',
	'url': '12.png'
}, {
	'id': 13,
	'phrase': '[流泪]',
	'url': '13.png'
}, {
	'id': 14,
	'phrase': '[偷笑]',
	'url': '14.png'
}, {
	'id': 15,
	'phrase': '[亲亲]',
	'url': '15.png'
}, {
	'id': 16,
	'phrase': '[生病]',
	'url': '16.png'
}, {
	'id': 17,
	'phrase': '[开心]',
	'url': '17.png'
}, {
	'id': 18,
	'phrase': '[懒得理你]',
	'url': '18.png'
}, {
	'id': 19,
	'phrase': '[左哼哼]',
	'url': '19.png'
}, {
	'id': 20,
	'phrase': '[右哼哼]',
	'url': '20.png'
}, {
	'id': 21,
	'phrase': '[嘘]',
	'url': '21.png'
}, {
	'id': 22,
	'phrase': '[衰]',
	'url': '22.png'
}, {
	'id': 23,
	'phrase': '[委屈]',
	'url': '23.png'
}, {
	'id': 24,
	'phrase': '[吐]',
	'url': '24.png'
}, {
	'id': 25,
	'phrase': '[打哈欠]',
	'url': '25.png'
}, {
	'id': 26,
	'phrase': '[抱抱]',
	'url': '26.png'
}, {
	'id': 27,
	'phrase': '[怒]',
	'url': '27.png'
}, {
	'id': 28,
	'phrase': '[疑问]',
	'url': '28.png'
}, {
	'id': 29,
	'phrase': '[馋嘴]',
	'url': '29.png'
}, {
	'id': 30,
	'phrase': '[拜拜]',
	'url': '30.png'
}, {
	'id': 31,
	'phrase': '[思考]',
	'url': '31.png'
}, {
	'id': 32,
	'phrase': '[汗]',
	'url': '32.png'
}, {
	'id': 33,
	'phrase': '[困]',
	'url': '33.png'
}, {
	'id': 34,
	'phrase': '[睡觉]',
	'url': '34.png'
}, {
	'id': 35,
	'phrase': '[钱]',
	'url': '35.png'
}, {
	'id': 36,
	'phrase': '[失望]',
	'url': '36.png'
}, {
	'id': 37,
	'phrase': '[酷]',
	'url': '37.png'
}, {
	'id': 38,
	'phrase': '[花心]',
	'url': '38.png'
}, {
	'id': 39,
	'phrase': '[哼]',
	'url': '39.png'
}, {
	'id': 40,
	'phrase': '[鼓掌]',
	'url': '40.png'
}, {
	'id': 41,
	'phrase': '[晕]',
	'url': '41.png'
}, {
	'id': 42,
	'phrase': '[悲伤]',
	'url': '42.png'
}, {
	'id': 43,
	'phrase': '[抓狂]',
	'url': '43.png'
}, {
	'id': 44,
	'phrase': '[黑线]',
	'url': '44.png'
}, {
	'id': 45,
	'phrase': '[阴脸]',
	'url': '45.png'
}, {
	'id': 46,
	'phrase': '[怒骂]',
	'url': '46.png'
}, {
	'id': 47,
	'phrase': '[心]',
	'url': '47.png'
}, {
	'id': 48,
	'phrase': '[伤心]',
	'url': '48.png'
}, {
	'id': 49,
	'phrase': '[猪头]',
	'url': '49.png'
}, {
	'id': 50,
	'phrase': '[OK]',
	'url': '50.png'
}, {
	'id': 51,
	'phrase': '[耶]',
	'url': '51.png'
}, {
	'id': 52,
	'phrase': '[good]',
	'url': '52.png'
}, {
	'id': 53,
	'phrase': '[不要]',
	'url': '53.png'
}, {
	'id': 54,
	'phrase': '[赞]',
	'url': '54.png'
}, {
	'id': 55,
	'phrase': '[来]',
	'url': '55.png'
}, {
	'id': 56,
	'phrase': '[弱]',
	'url': '56.png'
}, {
	'id': 57,
	'phrase': '[蜡烛]',
	'url': '57.png'
}, {
	'id': 58,
	'phrase': '[钟]',
	'url': '58.png'
}, {
	'id': 59,
	'phrase': '[蛋糕]',
	'url': '59.png'
}, {
	'id': 60,
	'phrase': '[话筒]',
	'url': '60.png'
}, {
	'id': 61,
	'phrase': '[篮球]',
	'url': '61.png'
}, {
	'id': 62,
	'phrase': '[足球]',
	'url': '62.png'
}, {
	'id': 63,
	'phrase': '[干杯]',
	'url': '63.png'
}, {
	'id': 64,
	'phrase': '[咖啡]',
	'url': '64.png'
}, {
	'id': 65,
	'phrase': '[刀叉]',
	'url': '65.png'
}, {
	'id': 66,
	'phrase': '[给力]',
	'url': '66.png'
}, {
	'id': 67,
	'phrase': '[汉堡包]',
	'url': '67.png'
}, {
	'id': 68,
	'phrase': '[酒店]',
	'url': '68.png'
}, {
	'id': 69,
	'phrase': '[奖杯]',
	'url': '69.png'
}, {
	'id': 70,
	'phrase': '[写信]',
	'url': '70.png'
}, {
	'id': 71,
	'phrase': '[地图]',
	'url': '71.png'
}, {
	'id': 72,
	'phrase': '[面条]',
	'url': '72.png'
}, {
	'id': 73,
	'phrase': '[米饭]',
	'url': '73.png'
}, {
	'id': 74,
	'phrase': '[披萨]',
	'url': '74.png'
}, {
	'id': 75,
	'phrase': '[飞机]',
	'url': '75.png'
}, {
	'id': 76,
	'phrase': '[礼物]',
	'url': '76.png'
}, {
	'id': 77,
	'phrase': '[钱包]',
	'url': '77.png'
}, {
	'id': 78,
	'phrase': '[气球]',
	'url': '78.png'
}, {
	'id': 79,
	'phrase': '[送花]',
	'url': '79.png'
}, {
	'id': 80,
	'phrase': '[寿司]',
	'url': '80.png'
}, {
	'id': 81,
	'phrase': '[薯条]',
	'url': '81.png'
}, {
	'id': 82,
	'phrase': '[星星]',
	'url': '82.png'
}, {
	'id': 83,
	'phrase': '[太阳]',
	'url': '83.png'
}, {
	'id': 84,
	'phrase': '[月亮]',
	'url': '84.png'
}, {
	'id': 85,
	'phrase': '[甜品]',
	'url': '85.png'
}, {
	'id': 86,
	'phrase': '[牛奶]',
	'url': '86.png'
}, {
	'id': 87,
	'phrase': '[西瓜]',
	'url': '87.png'
}, {
	'id': 88,
	'phrase': '[优惠劵]',
	'url': '88.png'
}];

;
(function($) {
	$.fn.extend({
		/**
		 * 扩展方法用于对输入框做提示
		 * version 2.0
		 * @param options
		 * version 3.0 增加样式切换 options.inputClass 当文本框中输入有效字符的样式
		 * 						options.removeClass 当文本框获取焦点移除的样式
		 */
		"autoTips": function(options) {
			var opt = $.extend({
				inputClass: "",
				removeClass: ""
			}, options || {});
			return $(this).each(function(i, n) {
				var $item = $(n);
				var tips = $item.attr("tips");
				if (tips) {
					$item.bind("focus", function() {
						if ($item.val() == tips) {
							$item.val("").removeClass(opt.removeClass).addClass(opt.inputClass);
						}
					}).bind("blur", function() {
						if (!$item.val()) {
							$item.removeClass(opt.inputClass).addClass(opt.removeClass).val(tips);
						}
					});
				}
			});
		},

		/**
		 * 扩展方法用于获取省份列表,同时设置默认城市
		 * @param options{
		 * 		choosenPro : 29 || "广州" //默认选择的省份ID/文字
		 * 		callback   ： function(data){}  //回调方法
		 * 		isCache	   : true	//默认不调用接口
		 * 		isTip	   : false	//默认没有 "请选择" 的选项
		 * 		}
		 * version 2.0 增加回调方法 callback data 为省份列表
		 *
		 * version 3.0 新增缓存 如果页面已经调用过一次则不需要再次调用
		 */
		"initProvince": function(options) {
			var opt = $.extend({
				isCache: true,
				isTip: false
			}, options || {});

			return $(this).each(function(i, n) {
				var _item = $(n);

				var handleProvince = function(data) {
					_item.empty();
					if (opt.isTip) {
						_item.append("<option provinceId=''>请选择</option>");
					}
					$.each(data, function(i, pro) {
						_item.append("<option provinceId=" + pro.provinceId + ">" + pro.provinceName + "</option>");
					});
					if (opt.choosenPro) {
						_item.find("option").each(function(i, nn) {
							if ($(nn).attr("provinceId") == opt.choosenPro || $(nn).val() == opt.choosenPro) {
								$(nn).attr("selected", true);
							}
						});
					}
					if ($.isFunction(opt.callback)) {
						options.callback(data);
					}

				};

				if (window.__provinces) {
					handleProvince(window.__provinces);
				} else {
					if (opt.isCache) {
						handleProvince(CONSTANTPROVINCE);
					} else {
						$.ajax({
							url: "../search/getProvincesAndCities.php",
							type: "post",
							dataType: "json",
							data: {
								type: "getAllProvinces"
							},
							success: function(res) {
								if (res.code == 200) {
									window.__provinces = res.extraData;
									handleProvince(res.extraData);
								}
							}
						});
					}
				}
			});
		},

		/**
		 * 扩展方法用于获取某一省份下地区列表,同时设置默认地区
		 * @param options {
		 * 			proId : 29 || "广东"			//省份的ID 或者 省份的中文
		 * 			choosenArea : 29 || "广州"  	//默认选择的市区ID/文字
		 * 		}
		 * @returns
		 */
		"initArea": function(options) {
			if (isNaN(options.proId)) {
				for (var i in CONSTANTPROVINCE) {
					if (CONSTANTPROVINCE[i].provinceName == options.proId) {
						options.proId = CONSTANTPROVINCE[i].provinceId;
					}
				}
				if (isNaN(options.proId)) {
					alert("请输入正确的省份格式");
				}
			}

			return $(this).each(function(i, n) {
				var _item = $(n);
				if (options.proId) {
					if (document.domain.match("www.shishanxianfeng")) {
						var url = "http://www.shishanxianfeng.com/City/getProAndCity";
					} else {
						var url = "../search/getProvincesAndCities.php";
					}
					$.ajax({
						url: url,
						dataType: "json",
						type: "post",
						data: {
							type: "getCitiesViaProvinceId",
							id: options.proId
						},
						success: function(res) {
							if (res.code = "200" && !$.isEmptyObject(res.extraData)) {
								_item.empty();
								$.each(res.extraData, function(i, city) {
									_item.append("<option cityId=" + city.cityId + ">" + city.cityName + "</option>");
								});
								if (options.choosenArea) {
									_item.find("option").each(function(i, nn) {
										if ($(nn).attr("cityId") == options.choosenArea || $(nn).val() == options.choosenArea) {
											$(nn).attr("selected", true);
										}
									})
								}
							} else {
								_item.empty();
								_item.append("<option cityId='null'>--</option>");
							}
						}
					});
				} else {
					alert("请输入省份ID");
				}
			})
		},

		/**
		 * 方法用于初始化年份下拉列表
		 * @param options
		 * @returns
		 */
		"initYear": function(options) {
			var _config = {
				endYear: 2013, //结束的年限
				length: 10, //总共的年限
				choosenYear: 2012 //被选中的年
			};
			var config = $.extend({}, _config, options);
			return $(this).each(function(i, n) {
				var _item = $(n);
				_item.empty();
				for (var year = config.endYear - config.length; year <= config.endYear; year++) {
					var _option = $('<option year=\"' + year + '\" value=\"' + year + '\">' + year + '</option>');
					if (year == config.choosenYear) {
						_option.attr("selected", "selected");
					}
					_item.append(_option);
				}
			});
		},

		// 方法用于初始化月份下拉列表
		"initMonth": function(options) {
			var _config = {
				year: 2013, //年份
				choosenMonth: 1 //被选中的月份
			};
			var config = $.extend({}, _config, options);
			return $(this).each(function(i, n) {
				var _item = $(n);
				_item.empty();
				var length = 12;
				for (var month = 1; month <= length; month++) {
					var holeMonth = month < 10 ? "0" + month : month;
					var _option = $("<option month=" + holeMonth + ">" + holeMonth + "</option>");
					if (holeMonth == config.choosenMonth) {
						_option.attr("selected", "selected");
					}
					_item.append(_option);
				}
			});
		},

		// 方法用于初始化月份下拉列表
		"initDay": function(options) {
			var _config = {
				year: 2013, //年份
				month: 1, //月份
				choosenDay: 1 //被选中的月份
			};
			var config = $.extend({}, _config, options);
			return $(this).each(function(i, n) {
				var _item = $(n);
				_item.empty();
				var isShort = config.year % 4 == 0 && config.year % 100 != 0 || config.year % 400 == 0;
				var mArra = [1, 3, 5, 7, 8, 10, 12];
				var length = 31;
				if ($.inArray(config.month, mArra) == -1) {
					if (config.month == 2 && isShort) {
						length = 29;
					} else if (config.month == 2 && !isShort) {
						length = 28;
					} else {
						length = 31;
					}
				}
				for (var day = 1; day <= length; day++) {
					var holeDay = day < 10 ? "0" + day : day;
					var _option = $("<option day=" + holeDay + ">" + holeDay + "</option>");
					if (holeDay == config.choosenDay) {
						_option.attr("selected", "selected");
					}
					_item.append(_option);
				}
			});
		},

		/**
		 * 图片填充整个父标签框
		 * 要求是父标签有定义好的width 和 height
		 */
		"fillImage": function() {
			return $(this).each(function(i, n) {
				var _item = $(n);
				var container = _item.parent();
				var boxWidth = container.width();
				var boxHeight = container.height();
				var imageScale = $.getImageScale(_item.attr("src"), boxWidth);
				if (imageScale.height < boxHeight) {
					_item.css({
						"width": "auto",
						"height": "100%"
					});
				} else {
					_item.css({
						"width": "100%",
						"height": "auto"
					});
				}
			});
		},

		/**
		 * 添加正在加载的提示
		 * str 提示的文字
		 * size "big"表示大尺寸 不填写默认为小尺寸
		 * @returns
		 */
		"addLoadingTip": function(str, size) {
			return $(this).each(function(i, n) {
				var _item = $(n);
				if (size && size == "big") {
					var _html = "<div class='__loadingTip' style='text-align: center;'>" +
						"<img style='display: inline;vertical-align: middle;margin-right:10px;' src='http://file.shishanxianfeng.com/imThemes/img/loading_big.gif' />" +
						"<span style='font-size:14px;letter-spacing: 1px;color: #222222;'>正在加载...</span>" +
						"</div>";
				} else {
					var _html = "<div class='__loadingTip' style='text-align: center;'>" +
						"<img style='display: inline;vertical-align: middle;margin-right:6px;' src='http://file.shishanxianfeng.com/imThemes/img/loading_small.gif' />" +
						"<span style='font-size:12px;line-height: 20px;color: #222222;'>正在加载...</span>" +
						"</div>";
				}
				_item.html(_html);
			});
		},

		/**
		 * 删除加载提示
		 * @returns
		 */
		"clearLoadingTip": function() {
			return $(this).each(function(i, n) {
				$(n).find(".__loadingTip").remove();
			});
		},

		/**
		 * 给 button 添加hover事件
		 * @returns
		 */
		"hoverBtn": function() {
			return $(this).each(function(i, n) {
				var _item = $(n);
				_item.css({
					"opacity": 0.75,
					"cursor": "pointer"
				});
				_item.bind("mouseenter.IM", function() {
					$(this).css("opacity", 1.0);
				}).bind("mouseleave.IM", function() {
					$(this).css("opacity", 0.75);
				});
			});
		},

		// 解除绑定
		"unbindHoverBtn": function() {
			return $(this).each(function(i, n) {
				var _item = $(n).css({
					"opacity": 1,
					"cursor": "default"
				}).unbind("mouseleave.IM").unbind("mouseenter.IM");
			});
		},

		// 表情初始化
		"initEmotion": function(option) {
			return $(this).each(function(i, n) {
				var _item = $(n);
				var _config = {
					left: 0,
					top: -199,
					zIndex: 9999,
					callback: function() {}
				};
				var config = $.extend({}, _config, option);
				var imThemesPath = "http://file.shishanxianfeng.com/imThemes";
				var imageurl = imThemesPath + "/images/face/";
				var facehtml = '<div class="__faceDiv" style="position: absolute;height: 197px;width: 435px;overflow: hidden;border-top: 1px solid #D8E7F8;border-left: 1px solid #D8E7F8;background-color: #FFFFFF;border-bottom: 1px solid #D8E7F8;"><ul>';
				for (var i = 0; i < EMOTIONS.length; i++) {
					facehtml += '<li emtionid="' + EMOTIONS[i].id + '" style="width:22px; height:26px;border-bottom: 1px solid #D8E7F8;border-right: 1px solid #D8E7F8;float: left;list-style-type: none;padding: 3px;" text=' + EMOTIONS[i].phrase + '>' +
						'<img src="' + imageurl + EMOTIONS[i].url + '" title="' + EMOTIONS[i].phrase + '"/>' +
						'</li>';
				}
				facehtml += "</ul></div>";

				var left = _item.offset().left + config.left;
				var top = _item.offset().top + config.top;
				$("body").append(facehtml);
				$(".__faceDiv").css({
					"top": top + "px",
					"left": left + "px",
					"z-index": config.zIndex
				}).show("fast");

				$(".__faceDiv").bind("click", function(event) {
					var _target = $(event.target);
					var _em = "";
					if (_target.is("li")) {
						_em = _target.attr("emtionid");
					} else {
						_em = _target.parent("li").attr("emtionid");
					}
					for (var i in EMOTIONS) {
						if (EMOTIONS[i].id == _em) {
							config.callback(EMOTIONS[i]);
						}
					}
				});
				$("body").bind("click", function(event) {
					if (event.target != _item[0]) {
						$(".__faceDiv").remove();
					}
				});
			});
		},

		/**
		 * 让图片居中展示
		 * 父容器必须定义了宽和高
		 * parentFilter 获取父标签的选择器
		 * vertical 是否在垂直方向居中
		 *
		 */
		"centerImage": function(opt) {
			var _default = {};
			var option = $.extend({}, _default, opt);
			return $(this).each(function(i, n) {
				var _item = $(n);
				var container = option.parentFilter ? _item.parent(option.parentFilter) : _item.parent();
				var boxWidth = container.width();
				var boxHeight = container.height();
				var imageScale = $.getImageScale(_item.attr("src"), boxWidth, boxHeight);
				var _css = {
					"display": "block",
					"margin": "auto"
				};
				_item.css({
					"width": imageScale.width,
					"height": imageScale.height
				}).css(_css);
				if (option.vertical) {
					if (imageScale.height < boxHeight) {
						_item.css("margin-top", (boxHeight - imageScale.height) / 2);
					}
				}
			});
		}
	});
})(jQuery);

/**
 * 上传插件的再次封装
 * 需要依赖的模块jquery.uploadify uploadify.css
 * config 参数和uploadify参数一样
 */
(function(jQuery) {
	jQuery.fn.myUploadify = function(config) {
		return this.each(function() {
			var _self = this;
			var flag = true;

			var debug = function() {
				if (flag) {
					console.log.apply(null, arguments);
				}
			}

			var selectError = function(file, code, msg) {
				if (code == '-110') {
					alert("你选择的" + file.name + "文件大小超过" + (config.fileSizeLimit || "4M") + "限制!");
				}
			}

			var onFallback = function() {
				alert("初始化Flash插件失败!");
			}

			var errorFunc = function(file, errorCode, errorMsg, errorString) {
				alert("文件\"" + file.name + "\"上传失败,错误码：" + errorCode);
			}

			/**
			 * 这个扩展插件添加了项目中默认的参数,同时进行了异常相关的处理
			 * 上传的默认参数
			 */
			var defaultConfig = {
				'swf': 'http://file.shishanxianfeng.com/uploadify/uploadify.swf',
				'debug': false, //开启调试模式
				'progressData': 'percentage', //显示上传进度的百分比
				'multi': true, //选择文件是一次是否能选择多个
				'uploader': '',
				'buttonClass': 'btnClass',
				'buttonText': '上传图片',
				'height': 35,
				'width': 90,
				'fileTypeExts': "*.jpg; *.png; *.gif",
				'fileSizeLimit': '4MB', //默认图片大小限制为4M
				'uploadLimit': 999, //允许上传文件的总数
				'queueID': 'uploadQueue', //绑定进度条的div
				'removeTimeout': 0.1, //完成的队列移除(DOM)的时延秒数
				'onUploadSuccess': function() {},
				'onUploadError': errorFunc,
				'onSelect': function() {}, //当每个文件被选择并添加到队列中时触发
				'onSelectError': selectError, //当每个文件被选择时返回错误后触发
				'onFallback': onFallback, //初始化失败
				'overrideEvents': ['onSelectError'], //你想要绕过默认事件的脚本名的数组
				'onClearQueue': function() {},
				'onDialogClose': function() {},
				'onUploadComplete': function() {}, //文件上传完毕
				'onQueueComplete': function() {},
				'button_image_url': 'test' //使用jquery.uploadify-3.1.js就会出现,是uploadify的bug.如果不设置这个参数,访问时就会指向controllers/personal从而出现403问题;设置成任一路径后能解决403,但会出现404
			}

			var newConfig = $.extend({}, defaultConfig, config);
			var succF = newConfig.onUploadSuccess;

			newConfig.onUploadSuccess = function(file, data, response) {
				successFunc(file, data, response, succF);
			}

			//上传成功的回调函数
			var successFunc = function(file, data, response, callback) {
				var jsonDate = {};
				try {
					jsonDate = $.parseJSON(data);
				} catch (e) {
					if (flag && window.console) {
						console.error(e);
					}
					alert("获取返回信息失败!");
					return;
				}

				switch (jsonDate.code) {
					case "200":
						callback(file, jsonDate.extraData || {});
						break;
					case "5000":
						alert("上传路径不正确!");
						break;
					default:
						alert(jsonDate.message);
						debug(jsonDate.code, jsonDate.message);
				}
			}

			if (!newConfig.uploader) {
				alert("请配置上传路径!");
			} else {
				$(_self).uploadify(newConfig);
			}
		});
	}
})(jQuery);

/**
 *对Date的扩展，将 Date 转化为指定格式的String
 *月(M)、日(d)、小时(h)、分(m)、秒(s)、季度(q) 可以用 1-2 个占位符，
 *年(y)可以用 1-4 个占位符，毫秒(S)只能用 1 个占位符(是 1-3 位的数字)
 *例子：
 *(new Date()).Format("yyyy-MM-dd hh:mm:ss.S") ==> 2006-07-02 08:09:04.423
 *(new Date()).Format("yyyy-M-d h:m:s.S")      ==> 2006-7-2 8:9:4.18
 * version 1.0
 */
Date.prototype.Format = function(fmt) {
	var o = {
		"M+": this.getMonth() + 1, //月份 
		"d+": this.getDate(), //日 
		"h+": this.getHours(), //小时 
		"m+": this.getMinutes(), //分 
		"s+": this.getSeconds(), //秒 
		"q+": Math.floor((this.getMonth() + 3) / 3), //季度 
		"S": this.getMilliseconds() //毫秒 
	};
	if (/(y+)/.test(fmt))
		fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "")
			.substr(4 - RegExp.$1.length));
	for (var k in o)
		if (new RegExp("(" + k + ")").test(fmt))
			fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
	return fmt;
};

/**
 * 将特定格式的时间字符串转化成Date对象
 * @returns {Date}
 */
String.prototype.toDate = function() {
	var temp = this.toString();
	temp = temp.replace(/-/g, "/");
	var date = new Date(Date.parse(temp));
	return date;
};

//jQuery 对象扩展方法
jQuery.extend({
	/**
	 * 获取autoInput方法的input中的value
	 * @param $dom
	 * @returns
	 */
	getAutoValue: function($dom) {
		if (!$dom.length) {
			return;
		}
		var val = $.trim($dom.val());
		return (val == $dom.attr("tips")) ? "" : val;
	},

	/**
	 * 数组删除元素 dx为数组下标 从0开始
	 * @param arr 输入的数组
	 * @param dx
	 * @returns {Boolean}
	 */
	arrayRemove: function(arr, dx) {
		if (isNaN(dx) || dx > arr.length) {
			return false;
		}
		arr.splice(dx, 1);
	},

	/**
	 * 	获取图片的尺寸
	 *  demo:http://file.shishanxianfeng.com/uploads/tasteScenery/860X650/20130903/137820873712_1680a1050.jpg
	 *  其中1680:1050为图片的比例
	 * @param image 图片的路径
	 * @param width 设置的宽度
	 * @param height 设置的高度 (如果设置了width 则height失效)
	 * 			如果width和hight都为空则返回原始的尺寸
	 * 			如果width 和 height值同时存在则先按width计算 再按 height计算
	 * @returns
	 */
	getImageScale: function(image, width, height) {
		if (image && image.lastIndexOf("_") !== -1) {
			var _s = image.substring(image.lastIndexOf("_") + 1, image.lastIndexOf(".")).split("a");
			var _width = _s[0];
			var _height = _s[1];
			if (width && height) {
				var _h = Math.round(width * _height / _width);
				if (_h <= height) {
					return {
						"width": width,
						"height": _h
					};
				} else {
					return {
						"width": Math.round(height * _width / _height),
						"height": height
					};
				}
			} else if (width) {
				return {
					"width": width,
					"height": Math.round(width * _height / _width)
				};
			} else if (height) {
				return {
					"width": Math.round(height * _width / _height),
					"height": height
				};
			} else {
				return {
					"width": _width,
					"height": _height
				};
			}
		} else {
			return null;
		}
	},

	/**
	 * 获取完整的图片路径
	 * @param type
	 * @param size
	 * @param url
	 */
	getIntegralImgUrl: function(type, size, url) {
		var FILEBASEURL = "http://file.shishanxianfeng.com/uploads/";
		if (type && size && url) {
			return FILEBASEURL + type + "/" + size + "/" + url;
		} else {
			alert("请输入完整的图片信息!");
			return "";
		}
	},

	/**
	 * 瀑布流滚动到底部加载
	 * @param config
	 */
	scrollLoad: function(config) {
		var _default = {
			ajaxUrl: "", //ajax请求的URL
			ajaxDataType: "html", //ajax返回数据格式
			ajaxType: "get", //ajax请求方式
			ajaxData: {}, //ajax提交的参数
			totalPage: 99, //总页数 
			debug: false, //是否输出提示信息
			beforeBottom: 50, //距离低端距离开始加载
			loadingTipId: "__loadingTip", //加载提示的Id
			noMoreTipId: "__noMoreTip", //没有更多提示的Id
			loadFunc: function(res, flush) {}, //加载完毕后回调函数 第一个参数res为异步获取的数据 第二个参数为flush方法 当isCallbackAsync为false时需要手动调用
			isCallbackAsync: true //回调方法默认是异步的 如果是同步的 则flush需要手动调用flush方法,
		};
		var option = $.extend({}, _default, config);
		if (!option.ajaxUrl) {
			alert("请输入URL");
		}

		var winHeight = $(window).height();
		var bodyHeight = $("body").height();
		var _scrollTop = 0;
		var _flag = true;
		var index = 1; //加载次数

		var debug = function() {
			if (option.debug) {
				for (var i in arguments) {
					console.log(arguments[i]);
				}
			}
		};

		var load = function(callback) {
			$("#" + option.loadingTipId).fadeIn(function() {
				$(this).show();
			});
			var data = $.extend({}, option.ajaxData, {
				page: index
			});
			$.ajax({
				url: option.ajaxUrl,
				dataType: option.ajaxDataType,
				type: option.ajaxType,
				data: data,
				success: function(res) {
					if (option.isCallbackAsync) {
						callback(res);
						reflush();
					} else {
						callback(res, reflush);
					}
				}
			});
		};

		var scrollFunc = function() {
			var $this = $(window);
			var scrollTop = $this.scrollTop();
			var bodyHeight = $("body").height();
			var winHeight = $(window).height();
			//保证向下滚动
			if (_flag && (scrollTop > _scrollTop)) {
				if ((bodyHeight - winHeight - scrollTop) < option.beforeBottom) {
					if (index < option.totalPage) {
						_flag = false;
						++index;
						debug("当前是第：" + index + "页");
						load(option.loadFunc);
						debug("bodyHeight: " + bodyHeight);
						debug("winHeight: " + winHeight);
						debug("scrollTop: " + scrollTop);
					}
				}
				_scrollTop = scrollTop;
			}
		};

		//没有更多了
		var noMore = function() {
			$("#" + option.loadingTipId).hide();
			$("#" + option.noMoreTipId).show();
		};

		var reflush = function() {
			debug("reflush OK");
			winHeight = $(window).height();
			bodyHeight = $("body").height();
			debug("reflush:" + bodyHeight);
			_flag = true;
			bindScroll();
			if (index == option.totalPage) {
				noMore();
			}
		};

		var bindScroll = function() {
			$(window).unbind("scroll", scrollFunc).bind("scroll", scrollFunc);
		};

		reflush();
	},

	// 将文字转化成img标签
	toImageTag: function(str, className) {
		var regx = /(\[[\u4e00-\u9fa5]*\w*\])/g;
		var rs = str.match(regx);
		if (rs != null) {
			for (var i = 0; i < rs.length; i++) {
				for (var n = 0; n < EMOTIONS.length; n++) {
					if (EMOTIONS[n].phrase == rs[i]) {
						var t = '<img style="vertical-align: middle;" ' + (className ? "class=\"" + className + "\"" : "") + ' src=http://file.shishanxianfeng.com/imThemes/images/face/' + EMOTIONS[n].url + '>';
						str = str.replace(rs[i], t);
						break;
					}
				}
			}
		}
		return str;
	},

	// 将img标签转化成文字
	toEmotionString: function(str) {
		if (!str) {
			return "";
		}
		return str.replace(/<img[^>]+>/g, function(res) {
			return $(res).attr("title")
		});
	},

	// 字符转义
	encodeHtml: function(str) {
		var temp = str;
		temp = temp.replace(/&/g, "&amp;");
		temp = temp.replace(/</g, "&lt;");
		temp = temp.replace(/>/g, "&gt;");
		temp = temp.replace(/"/g, "&quot;");
		return temp;
	},

	/**
	 * 提取表单中的数据 方便ajax提交时获取
	 * 只支持一个表单
	 */
	getFormData: function($form) {
		if ($form.length == 0) {
			return;
		}
		var form = $($form[0]);
		var res = {};
		form.find("input:text,input:hidden").each(function(i, n) {
			var $n = $(n);
			var key = $n.attr("name");
			if (key) {
				res[key] = $.getAutoValue($n);
			} else {
				res[key] = "";
			}
		});

		form.find("textarea").each(function(i, n) {
			var $n = $(n);
			var key = $n.attr("name");
			if (key) {
				res[key] = $.getAutoValue($n);
			} else {
				res[key] = "";
			}
		});

		form.find("select").each(function(i, n) {
			var $n = $(n);
			var key = $n.attr("name");
			if (key) {
				res[key] = $n.val();
			} else {
				res[key] = "";
			}
		});

		return res;
	},

	/**
	 * 简单的表单校验
	 * required 表示不能为空
	 */
	simpleValidata: function($dom, option) {
		if (!$dom || $dom.length == 0) {
			alert("请填入需要校验的form表单");
			return false;
		}
		var defaultOpt = {
			msg: {
				empty: "不能为空"
			}, //默认错误提示信息
			tipsName: {}, //每个form元素对应的提示名称
			isBreak: true, //是否检验到错误立即终止	
			warnFunc: function($dom, str) {
				alert(str);
			}
		};
		var isWarn = false;
		var opt = $.extend({}, defaultOpt, option);
		var res = {
			flag: true,
			detail: []
		};

		var _warnFunc = function($dom, str) {
			if (opt.isBreak) {
				if (!isWarn) {
					isWarn = true;
					res.flag = false;
					res.detail.push({
						dom: $dom,
						str: str
					});
					opt.warnFunc($dom, str);
				}
			} else {
				res.flag = false;
				res.detail.push({
					dom: $dom,
					str: str
				});
				opt.warnFunc($dom, str);
			}
		};

		/**
		 * required 为true 表示必选项
		 * tipsName 为提示时需要的中文名称
		 */
		$dom.each(function(i, formItem) {
			var $item = $(formItem);
			$item.find("input:text,textarea").each(function(i, n) {
				var $n = $(n);
				var isRequired = $n.attr("val_required");
				var tipsName = $n.attr("tipsName");
				var value = $.trim($.getAutoValue($n));
				if (isRequired && value == "") {
					if (tipsName) {
						_warnFunc($n, tipsName + opt.msg.empty);
					} else {
						_warnFunc($n, opt.msg.empty);
					}
				}
			});
		});

		return res;
	},

	/**
	 * 取消事件的默认行为
	 * 主要作用于直接在标签上 onclick = func 的方式
	 */
	preventDefault: function(event) {
		if (window.ActiveXObject) {
			window.event ? (window.event.returnValue = false) : "";
		} else {
			event ? event.preventDefault() : "";
		}
	},

	/**
	 * 阻止事件的传播
	 * 主要作用于直接在标签上 onclick = func 的方式
	 */
	stopPropagation: function(event) {
		if (window.ActiveXObject) {
			window.event ? (window.event.cancelBubble = true) : ""; //停止冒泡
		} else {
			event ? event.stopPropagation() : "";
		}
	},

	/**
	 * copy 自 jquery.cookie.js
	 * @param name
	 * @param value
	 * @param options
	 * @returns
	 */
	myCookie: function(name, value, options) {
		if (typeof value != 'undefined') { // name and value given, set cookie
			options = options || {};
			if (value === null) {
				value = '';
				options.expires = -1;
			}
			var expires = '';
			if (options.expires && (typeof options.expires == 'number' || options.expires.toUTCString)) {
				var date;
				if (typeof options.expires == 'number') {
					date = new Date();
					date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000));
				} else {
					date = options.expires;
				}
				expires = '; expires=' + date.toUTCString(); // use expires attribute, max-age is not supported by IE
			}
			// CAUTION: Needed to parenthesize options.path and options.domain
			// in the following expressions, otherwise they evaluate to undefined
			// in the packed version for some reason...
			var path = options.path ? '; path=' + (options.path) : '';
			var domain = options.domain ? '; domain=' + (options.domain) : '';
			var secure = options.secure ? '; secure' : '';
			document.cookie = [name, '=', encodeURIComponent(value), expires, path, domain, secure].join('');
		} else { // only name given, get cookie
			var cookieValue = null;
			if (document.cookie && document.cookie != '') {
				var cookies = document.cookie.split(';');
				for (var i = 0; i < cookies.length; i++) {
					var cookie = jQuery.trim(cookies[i]);
					// Does this cookie string begin with the name we want?
					if (cookie.substring(0, name.length + 1) == (name + '=')) {
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
			return cookieValue;
		}
	}
});


/**
 * 字符串拼接
 * @returns {StringBuffer}
 */
function StringBuffer() {
	this.array = new Array();
}

StringBuffer.prototype.append = function(value) {
	this.array[this.array.length] = value;
	return this;
};

StringBuffer.prototype.toString = function() {
	var _string = this.array.join("");
	return _string;
};

/**
 * 简单的map对象
 * @returns {ToolMap}
 */
function ToolMap() {
	var cache = {};

	this.put = function(key, value) {
		cache[key] = value;
	};

	this.get = function(key) {
		return cache[key];
	};

	this.remove = function(key) {
		delete cache[key];
	};

	this.clear = function() {
		cache = {};
	};
	this.isExist = function(key) {
		return cache[key] != null;
	};
};

/**
 * 全局的工具方法
 * 主要作用于IM项目
 */
IMTOOL = {
	isLogin: function() {
		var obj = (window.top !== window) ? top.IM : IM;
		if (!obj.SelfCacheManager.isLogin()) {
			obj.openDialogManager.openLogin();
			return false;
		} else {
			return true;
		}
	},

	//ajax检测到没有登录  预留登录完成后的回调
	noLogin: function(callback) {
		if (window.top !== window) {
			top.IM.SelfCacheManager.reset();
			top.IM.openDialogManager.openLogin();
		}
	},

	showLoginDialogue: function() {
		top.window.location.href = "http://im.shishanxianfeng.com";
	},

	fixTool: function($dom, opt) {
		var _default = {
			marginLeft: "1457px"
		};
		var option = $.extend({}, _default, opt);

		var $html =
			$('<div class="leftSide_float">' +
				'<div class="leftSide_float_outerbox toTOP" style="display:none">' +
				'<span class="leftSide_float_tImg icon"></span>' +
				'<span class="leftSide_float_tImg text">回到顶部</span>' +
				'</div>' +
				'<div class="leftSide_float_outerbox suggestion">' +
				'<span class="leftSide_float_tImg icon"></span>' +
				'<span class="leftSide_float_tImg text">意见反馈</span>' +
				'</div>' +
				'<div class="leftSide_float_outerbox downloadApp">' +
				'<span class="leftSide_float_tImg icon"></span>' +
				'<a class="leftSide_float_tImg text" target="_blank" href="http://www.shishanxianfeng.com/index/Index/mobileversion">下载APP</a>' +
				'</div>' +
				'<div class="left_phone_img">' +
				'<img src="http://file.shishanxianfeng.com/imThemes/images/eweima_2.jpg" alt="二维码"/>' +
				'<p>扫一扫下载手机客户端更精彩</p>' +
				'</div>' +
				'</div>');
		var topBtn = $html.find(".toTOP").click(function() {
			$("html, body").animate({
				scrollTop: 0
			}, 120);
			$(this).hide();
		});

		$html.css({
			"marginLeft": option.marginLeft
		});

		$html.find(".leftSide_float_outerbox").mouseenter(function() {
			$(this).addClass("focus");
		}).mouseleave(function() {
			$(this).removeClass("focus");
		});

		$html.find(".suggestion").click(function() {
			if (window.top !== window) {
				top.IM.openDialogManager.openSuggestion();
			}else{
				IM.openDialogManager.openSuggestion();
				$('.msgbox_wrapper').css('position', 'fixed');
			}
		});

		var key = "";
		var keyOut = "";
		$html.find(".downloadApp").mouseenter(function() {
			clearTimeout(keyOut);
			clearTimeout(key);
			keyOut = "";
			key = "";
			if (!key) {
				key = setTimeout(function() {
					$html.find(".left_phone_img").show();
				}, 500);
			}
		}).mouseleave(function() {
			clearTimeout(key);
			clearTimeout(keyOut);
			keyOut = "";
			key = "";
			if (!keyOut) {
				keyOut = setTimeout(function() {
					$html.find(".left_phone_img").hide();
				}, 500);
			}
		});

		$html.find(".left_phone_img").mouseenter(function() {
			clearTimeout(keyOut);
			clearTimeout(key);
			keyOut = "";
			key = "";
			$(this).show();
		}).mouseleave(function() {
			$(this).hide();
		});

		$(window).bind("scroll", function() {
			if (!key) {
				key = setTimeout(function() {
					var _top = $(document).scrollTop();
					if (_top > 300) {
						topBtn.show();
					} else {
						topBtn.hide();
					}
					key = "";
				}, 500);
			}
		});

		($dom || $("body")).append($html);
	},

	// 设置本地的缓存
	localCache: {},

	getInfoCache: {
		isEnter: false,
		loadingMemberId: "",
		setTimeoutKey: ""
	},

	/**
	 * 鼠标悬停在用户名或者头像上
	 * @param _this		dom节点
	 * @param memberId	用户的Id
	 * @param isClose	false 和没有值表示打开
	 * @param other		扩展字段
	 */
	getInfo: function(_this, memberId, isClose, other) {
		var $this, $html, setFunc, setFollow, debug;

		debug = function() {
			if (window.console && false) {
				for (var i in arguments) {
					console.log(arguments[i]);
				}
			};
		};

		if (!_this)
			return;
		$this = $(_this);
		if (isNaN(memberId)) {
			memberId = $this.attr("data_memberId");
		}

		$html = $('<div data-memberId="" class="meb_info" style="background-color: #FFFFFF;box-shadow: 0 0 13px 1px #999999;top:0;left:0;width:280px;height:140px;border:1px solid #999999;border-radius:2px;position:absolute;z-index:99999;">' +
			'<div class="meb_loading_tip" style="height:140px; text-align:center;line-height:100px;">正在加载...</div>' +
			'<div class="meb_text_container" style="height:70px;clear:both;display:none;">' +
			'<a style="margin:10px;display: block;width:50px;float: left;" href="javascript:;"><img class="meb_portrait" src=""></a>' +
			'<div style="float: left; margin-top:4px;">' +
			'<a class="meb_nickName" style="line-height: 22px; color:#333;" href="javascript:;"></a>' +
			'<div>' +
			'<span class="meb_gender" style="margin-left:10px;line-height: 22px; color:#666;">&nbsp;</span>' +
			'<span class="meb_location" style="margin-left:21px;line-height: 22px; color:#666;">来自&nbsp;:&nbsp;</span>' +
			'</div>' +
			'<div style="width:200px;">' +
			'<a class="meb_follows" style="padding:0 10px; color:#333;" href="javascript:;">关注&nbsp0</a>' +
			'<a class="meb_fans" style="padding:0 10px; color:#333;" href="javascript:;">粉丝&nbsp0</a>' +
			'<a class="meb_zans" style="padding:0 10px; color:#333;" href="javascript:;">赞&nbsp0</a>' +
			'</div>' +
			'</div>' +
			'<div style="float:left; vertical-align: middle; padding: 20px 0;">' +
			'</div>' +
			'</div>' +
			'<div class="meb_desc_container" style="height:70px;overflow: hidden; margin: 0 10px; border-top: 1px solid #eeeeee;display:none;">' +
			'<div  style="height:35px;">' +
			'<p class="meb_desc" style="margin-top:4px; color:#666;">这个家伙很懒,什么都没有留下~</p>' +
			'</div>' +
			'<span class="meb_addFollow" style="cursor:pointer; margin-left: 148px;margin-right: 3px;background-color:#84AF00 ;display: inline-block; border-radius: 2px; color: #FFFFFF; display: inline-block;padding: 0 3px;">' +
			'<b style="color: #FFFFFF;font-family: arial; font-size: 19px; font-weight: bold; text-shadow: 0 1px 0 #759B00;vertical-align: middle;">+</b>' +
			'&nbsp;加关注' +
			'</span>' +
			'<span class="meb_talk" style="cursor:pointer; margin-left:6px;height: 24px;line-height:22px; display: inline-block;background-color:#84AF00 ;border-radius: 2px; color: #FFFFFF;padding: 0 3px;">对话TA</span>' +
			'</div>' +
			'<span class="meb_down" style="display:none;width:20px;margin-left: 19px;margin-top: -1px;height:10px;background: url(http://file.shishanxianfeng.com/imThemes/images/travelCommon/grey_down.png) repeat scroll 0 0;"></span>' +
			'<span class="meb_up" style="display:none;width:20px;margin-left: 19px;top: -9px; position: absolute; height:10px;background: url(http://file.shishanxianfeng.com/imThemes/images/travelCommon/grey_up.gif) repeat scroll 0 0;"></span>' +
			'</div>');

		$html.mouseenter(function() {
			IMTOOL.getInfoCache.isEnter = true;
		}).mouseleave(function() {
			IMTOOL.getInfoCache.isEnter = false;
			close();
		});

		var close = function(isNoDelay) {
			if (isNoDelay) {
				$(".meb_info").fadeOut("fast", function() {
					$(this).remove();
					IMTOOL.getInfoCache.isEnter = false;
				});
			} else {
				setTimeout(function() {
					$(".meb_info").fadeOut("fast", function() {
						$(this).remove();
						IMTOOL.getInfoCache.isEnter = false;
					});
				}, 500);
			}
		};

		var setFollow = function(memberId) {
			$.ajax({
				url: "http://im.shishanxianfeng.com/controllers/trends/followFriend.php",
				dataType: "json",
				type: "get",
				data: {
					memberId: memberId
				},
				success: function(res) {
					alert(res.message);
					if (res.code == 200) {
						//
					};
				}
			});
		};

		var getMemberId = function($dom) {
			if ($dom) {
				return $dom.parents(".meb_info").attr("data-memberId");
			}
		};

		//打开用户详细信息窗口
		var showMemberInfo = function(memberId) {
			if (window.top !== window) {
				top.getFindInformation(memberId);
			} else {
				getFindInformation(memberId);
			};
		};

		//展示关注 粉丝 赞
		var showInfoDetail = function(memberId, type) {
			top.IM.FriendListManager.getInfoDetail(memberId, type);
		};

		setFunc = function(data) {
			$html.find(".meb_desc_container").show().end().find(".meb_text_container").show();
			$html.find(".meb_loading_tip").hide();

			debug("设置数据.....");
			$html.attr("data-memberId", data.number);
			$html.find(".meb_portrait").attr("src", "http://file.shishanxianfeng.com/uploads/head/50X50/" + data.portrait);
			$html.find(".meb_nickName").text(data.nickName == "" ? data.number : data.nickName).click(function() {
				showMemberInfo(getMemberId($(this)));
				return false;
			});
			$html.find(".meb_portrait").click(function() {
				showMemberInfo(getMemberId($(this)));
				return false;
			});

			$html.find(".meb_gender").text(data.gender == "M" ? "男" : (data.gender == "L" ? "女" : " "));
			$html.find(".meb_location").text("来自 : " + data.residence);
			$html.find(".meb_follows").text("关注  " + data.fav).click(function() {
				top.IM.FriendListManager.getInfoDetail(getMemberId($(this)), 2);
				return false;
			});
			$html.find(".meb_fans").text("粉丝  " + data.fans).click(function() {
				top.IM.FriendListManager.getInfoDetail(getMemberId($(this)), 1);
				return false;
			});
			$html.find(".meb_zans").text("赞  " + data.zan).click(function() {
				top.IM.FriendListManager.getInfoDetail(getMemberId($(this)), 3);
				return false;
			});
			$html.find(".meb_desc").text(data.description != "" ? data.description : "这个家伙很懒,什么都没有留下~");

			$html.find(".meb_addFollow").click(function() {
				setFollow(getMemberId($(this)));
			});

			$html.find(".meb_talk").click(function() {
				top.IM.ChatWinManager.openChatView(getMemberId($(this)));
			});
		};

		//定位tip的位置
		var position = function() {
			var _top = _this.getBoundingClientRect().top;
			var _height = $(_this).height();
			debug("设置了位置...............", _top);
			if (_top < 150) {
				$html.css({
					top: $this.offset().top + _height + 10,
					left: $this.offset().left
				});
				$html.find(".meb_up").css("display", "block");
				$html.find(".meb_down").hide();
				debug("to top!");
			} else {
				$html.css({
					top: $this.offset().top - 150,
					left: $this.offset().left
				});
				$html.find(".meb_down").css("display", "block");
				$html.find(".meb_up").hide();
				debug("to down!");
			}
		};

		//打开
		if (!isClose) {
			position();
			clearTimeout(IMTOOL.getInfoCache.setTimeoutKey);
			$(".meb_info").remove();
			$("body").append($html);
			debug("mouseenter", _this);
		} else {
			debug("mouseleave", _this);
			clearTimeout(IMTOOL.getInfoCache.setTimeoutKey);
			IMTOOL.getInfoCache.setTimeoutKey = setTimeout(function() {
				if (!IMTOOL.getInfoCache.isEnter) {
					close(true);
				}
			}, 1000);
		}

		if (isClose) {
			return;
		}

		if (IMTOOL.localCache[memberId]) {
			setFunc(IMTOOL.localCache[memberId]);
		} else if (!IMTOOL.getInfoCache.loadingMemberId) {
			IMTOOL.getInfoCache.loadingMemberId = memberId;
			$.ajax({
				url: "http://im.shishanxianfeng.com/controllers/personal/getInfo.php",
				dataType: "json",
				type: "get",
				data: {
					number: memberId
				},
				success: function(res) {
					if (res.code == 200) {
						var data = res.extraData;
						setFunc(data);
						IMTOOL.localCache[memberId] = data;
					}
				},
				complete: function() {
					IMTOOL.getInfoCache.loadingMemberId = "";
				}
			});
		}
	},

	/**
	 * 参数化域名
	 */
	FILEBASEURL: "http://file.shishanxianfeng.com/",
	IMBASEURL: "http://im.shishanxianfeng.com/",
	WWWBASEURL: "http://www.shishanxianfeng.com/",
	JOBBASEURL: "http://job.shishanxianfeng.com/"
};

// 百度流量监控
$(function() {
	var result = $.map($("script"), function(n) {
		var url = $(n).attr("src");
		if (url && url.indexOf("http://hm.baidu.com/h.js") != -1 && url.indexOf("http://hm.baidu.com/hm.js") != -1) {
			return $(n);
		}
	});
	if (result.length == 0) {
		var str = "<script type=\"text/javascript\" src=\"http://hm.baidu.com/hm.js?1c9125db7feae6668f53b1f927f4ae97\">";
		$("head").append(str);
	}
});

/**
 * 面向对象编程
 * @returns
 */
var STool = STool || {};
STool.Menu = function(dom, X, Y) {
	this.dom = dom;
	this.X = X;
	this.Y = Y;
};

STool.Menu.prototype.rePosition = function() {
	var $dom = $(this.dom);
	var winHeight = $(window).height();
	var winWidth = $(window).width();
	var domHeight = parseInt($dom.height(), 10);
	var _top = 0;
	var _left = 0;
	if (this.Y + domHeight < winHeight) {
		_top = this.Y;
	} else if (domHeight < this.Y) {
		_top = this.Y - domHeight;
	} else {
		_top = 0;
	}
	_left = this.X;
	$dom.css({
		"top": _top,
		"left": _left
	});
};
/**
 *
 */
 